# ğŸ” Decap CMS GitHub OAuth Backend é…ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®æ‚¨å°† Decap CMS ä» **Netlify Identity** åˆ‡æ¢åˆ° **GitHub OAuth**ï¼Œå½»åº•è§£å†³ç™»å½•é—®é¢˜ã€‚

**é¢„è®¡æ—¶é—´**: 15-20 åˆ†é’Ÿ  
**éš¾åº¦**: â­â­ ç®€å•  
**æˆåŠŸç‡**: 95%+  
**æˆæœ¬**: å®Œå…¨å…è´¹

---

## âœ… ä¼˜åŠ¿

### è§£å†³çš„é—®é¢˜

âœ… **å½»åº•è§£å†³ç™»å½•é—®é¢˜**
- ä¸å†ä¾èµ–ä¸ç¨³å®šçš„ Netlify Identity
- ä½¿ç”¨ GitHub è´¦å·ç›´æ¥ç™»å½•
- ç¨³å®šå¯é 

âœ… **ä¿æŒå½“å‰æ¶æ„**
- ç»§ç»­ä½¿ç”¨ Decap CMS
- æ— éœ€è¿ç§»å†…å®¹
- é…ç½®æ”¹åŠ¨æœ€å°

âœ… **å¯åœ¨å…±äº«ä¸»æœºå¼€å‘**
- åªéœ€ä¿®æ”¹é…ç½®æ–‡ä»¶
- æ— éœ€æœ¬åœ° Node.js ç¯å¢ƒ
- æ‰€æœ‰æ“ä½œåœ¨çº¿å®Œæˆ

---

## ğŸ“ å‰ç½®è¦æ±‚

### å¿…éœ€

- âœ… GitHub è´¦å·ï¼ˆå·²æœ‰ï¼‰
- âœ… Netlify è´¦å·ï¼ˆå·²æœ‰ï¼‰
- âœ… é¡¹ç›®å·²éƒ¨ç½²åˆ° Netlifyï¼ˆå·²å®Œæˆï¼‰
- âœ… å¯¹ GitHub ä»“åº“æœ‰ç®¡ç†å‘˜æƒé™

### å¯é€‰

- GitHub ç»„ç»‡è´¦å·ï¼ˆå¦‚æœéœ€è¦å›¢é˜Ÿåä½œï¼‰

---

## ğŸš€ å®æ–½æ­¥éª¤

### ç¬¬ä¸€éƒ¨åˆ†: åˆ›å»º GitHub OAuth Appï¼ˆ5 åˆ†é’Ÿï¼‰

#### æ­¥éª¤ 1: è®¿é—® GitHub Developer Settings

**æ“ä½œ**:
```
1. ç™»å½• GitHub
2. ç‚¹å‡»å³ä¸Šè§’å¤´åƒ â†’ Settings
3. å·¦ä¾§èœå•æ»šåŠ¨åˆ°åº•éƒ¨ â†’ Developer settings
4. ç‚¹å‡» "OAuth Apps"
5. ç‚¹å‡» "New OAuth App"
```

**ç›´æ¥é“¾æ¥**: https://github.com/settings/developers

#### æ­¥éª¤ 2: å¡«å†™ OAuth App ä¿¡æ¯

**è¡¨å•å¡«å†™**:
```
Application name: Instagram Blog CMS
  (æˆ–ä»»ä½•æ‚¨å–œæ¬¢çš„åç§°)

Homepage URL: https://rad-dasik-e25922.netlify.app
  (æ‚¨çš„ Netlify ç«™ç‚¹ URL)

Application description: (å¯é€‰)
  Content management system for Instagram Blog

Authorization callback URL: https://api.netlify.com/auth/done
  (é‡è¦: å¿…é¡»æ˜¯è¿™ä¸ª URL)
```

**æ³¨æ„äº‹é¡¹**:
- âš ï¸ **Authorization callback URL å¿…é¡»å‡†ç¡®**
- âš ï¸ ä¸è¦æ·»åŠ å°¾éƒ¨æ–œæ 
- âš ï¸ ä½¿ç”¨ `https://` è€Œä¸æ˜¯ `http://`

#### æ­¥éª¤ 3: è·å–å‡­è¯

**æ“ä½œ**:
```
1. ç‚¹å‡» "Register application"
2. åœ¨æ–°é¡µé¢ä¸­ï¼Œæ‚¨ä¼šçœ‹åˆ°:
   - Client ID: ä¸€ä¸²å­—ç¬¦ï¼ˆä¾‹å¦‚: Iv1.a1b2c3d4e5f6g7h8ï¼‰
   - Client secrets: ç‚¹å‡» "Generate a new client secret"
3. å¤åˆ¶ Client IDï¼ˆä¿å­˜åˆ°è®°äº‹æœ¬ï¼‰
4. å¤åˆ¶ Client Secretï¼ˆä¿å­˜åˆ°è®°äº‹æœ¬ï¼‰
```

**é‡è¦**:
- âš ï¸ **Client Secret åªæ˜¾ç¤ºä¸€æ¬¡**
- âš ï¸ å¦‚æœä¸¢å¤±ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆ
- âš ï¸ ä¸è¦åˆ†äº«ç»™ä»–äºº

---

### ç¬¬äºŒéƒ¨åˆ†: é…ç½® Netlify OAuthï¼ˆ5 åˆ†é’Ÿï¼‰

#### æ­¥éª¤ 4: è®¿é—® Netlify ç«™ç‚¹è®¾ç½®

**æ“ä½œ**:
```
1. ç™»å½• Netlify: https://app.netlify.com
2. é€‰æ‹©ç«™ç‚¹: rad-dasik-e25922
3. ç‚¹å‡» "Site settings"
4. å·¦ä¾§èœå• â†’ Access control
5. æ»šåŠ¨åˆ° "OAuth" éƒ¨åˆ†
```

#### æ­¥éª¤ 5: å®‰è£… GitHub Provider

**æ“ä½œ**:
```
1. åœ¨ OAuth éƒ¨åˆ†ï¼Œç‚¹å‡» "Install provider"
2. åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­:
   - Provider: é€‰æ‹© "GitHub"
   - Client ID: ç²˜è´´æ‚¨åœ¨æ­¥éª¤ 3 å¤åˆ¶çš„ Client ID
   - Client Secret: ç²˜è´´æ‚¨åœ¨æ­¥éª¤ 3 å¤åˆ¶çš„ Client Secret
3. ç‚¹å‡» "Install"
```

**éªŒè¯**:
- âœ… åº”è¯¥çœ‹åˆ° "GitHub" å‡ºç°åœ¨ OAuth providers åˆ—è¡¨ä¸­
- âœ… çŠ¶æ€æ˜¾ç¤ºä¸º "Installed"

---

### ç¬¬ä¸‰éƒ¨åˆ†: ä¿®æ”¹ CMS é…ç½®ï¼ˆ5 åˆ†é’Ÿï¼‰

#### æ­¥éª¤ 6: ç¼–è¾‘é…ç½®æ–‡ä»¶

**æ–‡ä»¶**: `static/admin/config.yml`

**ä¿®æ”¹å‰**:
```yaml
# åç«¯é…ç½®
backend:
  name: git-gateway
  branch: main
```

**ä¿®æ”¹å**:
```yaml
# åç«¯é…ç½®
backend:
  name: github
  repo: alicsyn/instagram-blog  # æ ¼å¼: ç”¨æˆ·å/ä»“åº“å
  branch: main
```

**æ³¨æ„**:
- âš ï¸ ç¡®è®¤ `repo` æ ¼å¼æ­£ç¡®: `ç”¨æˆ·å/ä»“åº“å`
- âš ï¸ ä¸è¦åŒ…å« `https://github.com/`
- âš ï¸ åŒºåˆ†å¤§å°å†™

#### æ­¥éª¤ 7: å¯é€‰é…ç½®ä¼˜åŒ–

**æ·»åŠ ä»¥ä¸‹é…ç½®**ï¼ˆå¯é€‰ä½†æ¨èï¼‰:

```yaml
# åç«¯é…ç½®
backend:
  name: github
  repo: alicsyn/instagram-blog
  branch: main
  # å¯é€‰: ä½¿ç”¨ GraphQL APIï¼ˆæ›´å¿«ï¼‰
  use_graphql: true
  # å¯é€‰: å¯ç”¨å¤§æ–‡ä»¶æ”¯æŒ
  use_large_media_transforms_in_media_library: false

# ç§»é™¤ local_backendï¼ˆå¦‚æœæœ‰ï¼‰
# local_backend: true  # â† åˆ é™¤æˆ–æ³¨é‡Šæ‰è¿™è¡Œ
```

**å®Œæ•´çš„é…ç½®æ–‡ä»¶ç¤ºä¾‹**:
```yaml
# Decap CMS é…ç½®æ–‡ä»¶

# åç«¯é…ç½®
backend:
  name: github
  repo: alicsyn/instagram-blog
  branch: main
  use_graphql: true

# åª’ä½“æ–‡ä»¶é…ç½®
media_folder: "static/images/uploads"
public_folder: "/images/uploads"

# å‘å¸ƒæ¨¡å¼ - æ”¯æŒè‰ç¨¿å·¥ä½œæµ
publish_mode: editorial_workflow

# ç½‘ç«™ URL
site_url: https://rad-dasik-e25922.netlify.app
display_url: https://rad-dasik-e25922.netlify.app

# ä¸­æ–‡ç•Œé¢
locale: 'zh_Hans'

# é›†åˆé…ç½®ï¼ˆä¿æŒä¸å˜ï¼‰
collections:
  # ... æ‚¨ç°æœ‰çš„é›†åˆé…ç½® ...
```

---

### ç¬¬å››éƒ¨åˆ†: éƒ¨ç½²å’Œæµ‹è¯•ï¼ˆ5 åˆ†é’Ÿï¼‰

#### æ­¥éª¤ 8: æäº¤æ›´æ”¹

**åœ¨ Hostinger SSH æˆ–æœ¬åœ°ç»ˆç«¯**:
```bash
cd /home/u811056906/projects/instagram-blog

# æŸ¥çœ‹æ›´æ”¹
git diff static/admin/config.yml

# æ·»åŠ æ›´æ”¹
git add static/admin/config.yml

# æäº¤
git commit -m "Config: Switch to GitHub OAuth backend"

# æ¨é€åˆ° GitHub
git push origin main
```

#### æ­¥éª¤ 9: ç­‰å¾… Netlify éƒ¨ç½²

**æ“ä½œ**:
```
1. è®¿é—® Netlify æ§åˆ¶å°
2. è¿›å…¥ç«™ç‚¹: rad-dasik-e25922
3. ç‚¹å‡» "Deploys"
4. ç­‰å¾…æœ€æ–°éƒ¨ç½²å®Œæˆï¼ˆé€šå¸¸ 1-2 åˆ†é’Ÿï¼‰
5. çŠ¶æ€å˜ä¸º "Published"
```

**æˆ–è€…ç›´æ¥ç­‰å¾… 2-3 åˆ†é’Ÿ**

#### æ­¥éª¤ 10: æµ‹è¯•ç™»å½•

**æ“ä½œ**:
```
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆé‡è¦ï¼ï¼‰
   - Chrome: Ctrl+Shift+Delete
   - é€‰æ‹© "å…¨éƒ¨æ—¶é—´"
   - æ¸…é™¤ Cookie å’Œç¼“å­˜

2. è®¿é—®ç®¡ç†åå°:
   https://rad-dasik-e25922.netlify.app/admin/

3. åº”è¯¥çœ‹åˆ° "Login with GitHub" æŒ‰é’®

4. ç‚¹å‡»æŒ‰é’®

5. GitHub æˆæƒé¡µé¢:
   - æŸ¥çœ‹æƒé™è¯·æ±‚
   - ç‚¹å‡» "Authorize [æ‚¨çš„åº”ç”¨åç§°]"

6. è‡ªåŠ¨è·³è½¬å› CMS ç®¡ç†ç•Œé¢

7. æˆåŠŸç™»å½•ï¼ ğŸ‰
```

---

## ğŸ§ª éªŒè¯æµ‹è¯•

### æµ‹è¯•æ¸…å•

å®Œæˆä»¥ä¸‹æµ‹è¯•ä»¥ç¡®è®¤ä¸€åˆ‡æ­£å¸¸:

- [ ] å¯ä»¥è®¿é—® `/admin/`
- [ ] çœ‹åˆ° "Login with GitHub" æŒ‰é’®
- [ ] ç‚¹å‡»åè·³è½¬åˆ° GitHub æˆæƒé¡µé¢
- [ ] æˆæƒåæˆåŠŸç™»å½•
- [ ] å¯ä»¥æŸ¥çœ‹ç°æœ‰æ–‡ç« 
- [ ] å¯ä»¥åˆ›å»ºæ–°æ–‡ç« 
- [ ] å¯ä»¥ç¼–è¾‘æ–‡ç« 
- [ ] å¯ä»¥ä¸Šä¼ å›¾ç‰‡
- [ ] å¯ä»¥å‘å¸ƒæ–‡ç« 
- [ ] å‘å¸ƒå GitHub æœ‰æ–°æäº¤
- [ ] Netlify è‡ªåŠ¨æ„å»º
- [ ] æ–‡ç« æ˜¾ç¤ºåœ¨ç½‘ç«™ä¸Š

---

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜ 1: çœ‹ä¸åˆ° "Login with GitHub" æŒ‰é’®

**ç—‡çŠ¶**: ä»ç„¶æ˜¾ç¤º "Login with Netlify Identity"

**åŸå› **: æµè§ˆå™¨ç¼“å­˜

**è§£å†³**:
```
1. å®Œå…¨æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
2. ä½¿ç”¨æ— ç—•æ¨¡å¼
3. æˆ–ä½¿ç”¨ä¸åŒçš„æµè§ˆå™¨
4. ç¡®è®¤ Netlify éƒ¨ç½²å·²å®Œæˆ
```

---

### é—®é¢˜ 2: ç‚¹å‡»ç™»å½•åæ˜¾ç¤º "Error: Failed to load"

**ç—‡çŠ¶**: æˆæƒåè¿”å›é”™è¯¯

**åŸå› **: OAuth é…ç½®é”™è¯¯

**è§£å†³**:
```
1. æ£€æŸ¥ GitHub OAuth App çš„ Callback URL:
   å¿…é¡»æ˜¯: https://api.netlify.com/auth/done

2. æ£€æŸ¥ Netlify OAuth Provider:
   - Client ID æ­£ç¡®
   - Client Secret æ­£ç¡®

3. é‡æ–°ç”Ÿæˆ Client Secret:
   - åœ¨ GitHub OAuth App ä¸­
   - ç”Ÿæˆæ–°çš„ Secret
   - æ›´æ–° Netlify é…ç½®
```

---

### é—®é¢˜ 3: æˆæƒåæ˜¾ç¤º "Not Found"

**ç—‡çŠ¶**: GitHub æˆæƒæˆåŠŸï¼Œä½†è¿”å› 404

**åŸå› **: `repo` é…ç½®é”™è¯¯

**è§£å†³**:
```
1. æ£€æŸ¥ config.yml ä¸­çš„ repo:
   backend:
     name: github
     repo: alicsyn/instagram-blog  # ç¡®è®¤æ ¼å¼æ­£ç¡®

2. ç¡®è®¤ä»“åº“åç§°:
   - è®¿é—® GitHub ä»“åº“
   - å¤åˆ¶ URL ä¸­çš„ ç”¨æˆ·å/ä»“åº“å
   - ä¾‹å¦‚: https://github.com/alicsyn/instagram-blog
     â†’ repo: alicsyn/instagram-blog

3. ç¡®è®¤åˆ†æ”¯åç§°:
   - æ£€æŸ¥ GitHub ä»“åº“çš„é»˜è®¤åˆ†æ”¯
   - é€šå¸¸æ˜¯ main æˆ– master
```

---

### é—®é¢˜ 4: ç™»å½•æˆåŠŸä½†æ— æ³•ç¼–è¾‘

**ç—‡çŠ¶**: å¯ä»¥ç™»å½•ï¼Œä½†æ— æ³•ä¿å­˜æ›´æ”¹

**åŸå› **: GitHub æƒé™ä¸è¶³

**è§£å†³**:
```
1. ç¡®è®¤æ‚¨æ˜¯ä»“åº“çš„æ‰€æœ‰è€…æˆ–åä½œè€…

2. æ£€æŸ¥ GitHub OAuth App æƒé™:
   - åœ¨ GitHub æˆæƒé¡µé¢
   - åº”è¯¥è¯·æ±‚ "repo" æƒé™

3. é‡æ–°æˆæƒ:
   - GitHub â†’ Settings â†’ Applications
   - æ‰¾åˆ°æ‚¨çš„ OAuth App
   - ç‚¹å‡» "Revoke"
   - é‡æ–°ç™»å½• CMS
   - é‡æ–°æˆæƒ
```

---

### é—®é¢˜ 5: å›¾ç‰‡ä¸Šä¼ å¤±è´¥

**ç—‡çŠ¶**: æ— æ³•ä¸Šä¼ å›¾ç‰‡

**åŸå› **: åª’ä½“åº“é…ç½®

**è§£å†³**:
```
1. ç¦ç”¨ Uploadcareï¼ˆå¦‚æœé…ç½®äº†ï¼‰:
   # åœ¨ config.yml ä¸­æ³¨é‡Šæ‰:
   # media_library:
   #   name: uploadcare
   #   ...

2. ä½¿ç”¨é»˜è®¤çš„ Git LFS æˆ–ç›´æ¥æäº¤:
   # æ— éœ€é¢å¤–é…ç½®ï¼Œç›´æ¥ä¸Šä¼ å³å¯
```

---

## ğŸ“Š GitHub OAuth vs Netlify Identity å¯¹æ¯”

| ç‰¹æ€§ | GitHub OAuth | Netlify Identity |
|------|-------------|------------------|
| **ç¨³å®šæ€§** | â­â­â­â­â­ éå¸¸ç¨³å®š | â­â­ ç»å¸¸å‡ºé—®é¢˜ |
| **ç™»å½•é€Ÿåº¦** | â­â­â­â­â­ å¿«é€Ÿ | â­â­â­ è¾ƒæ…¢ |
| **é…ç½®éš¾åº¦** | â­â­ ç®€å• | â­â­â­ ä¸­ç­‰ |
| **ç”¨æˆ·ç®¡ç†** | GitHub è´¦å· | Netlify Identity |
| **æƒé™æ§åˆ¶** | GitHub ä»“åº“æƒé™ | Netlify é‚€è¯· |
| **æˆæœ¬** | å…è´¹ | å…è´¹ï¼ˆæœ‰é™åˆ¶ï¼‰ |
| **ä¾èµ–** | GitHub | Netlify + GitHub |
| **é€‚ç”¨åœºæ™¯** | ä¸ªäºº/å›¢é˜Ÿ | éæŠ€æœ¯ç”¨æˆ· |

---

## ğŸ¯ æœ€ä½³å®è·µ

### å®‰å…¨å»ºè®®

1. **å®šæœŸæ›´æ–° Client Secret**
   ```
   æ¯ 6-12 ä¸ªæœˆæ›´æ–°ä¸€æ¬¡
   ```

2. **é™åˆ¶ä»“åº“è®¿é—®**
   ```
   åªæˆæƒå¿…è¦çš„åä½œè€…
   ```

3. **ä½¿ç”¨åˆ†æ”¯ä¿æŠ¤**
   ```
   åœ¨ GitHub ä»“åº“è®¾ç½®ä¸­:
   Settings â†’ Branches â†’ Add rule
   ä¿æŠ¤ main åˆ†æ”¯
   ```

### å›¢é˜Ÿåä½œ

å¦‚æœéœ€è¦å¤šäººä½¿ç”¨ CMS:

1. **æ·»åŠ  GitHub åä½œè€…**
   ```
   GitHub ä»“åº“ â†’ Settings â†’ Collaborators
   æ·»åŠ å›¢é˜Ÿæˆå‘˜çš„ GitHub è´¦å·
   ```

2. **è®¾ç½®æƒé™**
   ```
   - Write: å¯ä»¥ç¼–è¾‘å’Œå‘å¸ƒ
   - Read: åªèƒ½æŸ¥çœ‹
   ```

3. **ä½¿ç”¨ GitHub ç»„ç»‡**ï¼ˆå¯é€‰ï¼‰
   ```
   åˆ›å»º GitHub Organization
   å°†ä»“åº“è½¬ç§»åˆ°ç»„ç»‡
   æ›´å¥½çš„å›¢é˜Ÿç®¡ç†
   ```

---

## ğŸ‰ å®Œæˆæ£€æŸ¥æ¸…å•

é…ç½®å®Œæˆåï¼Œç¡®è®¤ä»¥ä¸‹æ‰€æœ‰é¡¹ç›®:

- [ ] GitHub OAuth App å·²åˆ›å»º
- [ ] Client ID å’Œ Secret å·²ä¿å­˜
- [ ] Netlify OAuth Provider å·²å®‰è£…
- [ ] config.yml å·²æ›´æ–°
- [ ] æ›´æ”¹å·²æäº¤åˆ° GitHub
- [ ] Netlify éƒ¨ç½²æˆåŠŸ
- [ ] æµè§ˆå™¨ç¼“å­˜å·²æ¸…é™¤
- [ ] å¯ä»¥ä½¿ç”¨ GitHub ç™»å½•
- [ ] å¯ä»¥ç¼–è¾‘æ–‡ç« 
- [ ] å¯ä»¥ä¸Šä¼ å›¾ç‰‡
- [ ] å¯ä»¥å‘å¸ƒæ–‡ç« 
- [ ] GitHub æœ‰æ–°æäº¤
- [ ] ç½‘ç«™è‡ªåŠ¨æ›´æ–°

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜:

1. **æ£€æŸ¥é…ç½®**
   - ä»”ç»†å¯¹ç…§æœ¬æŒ‡å—
   - ç¡®è®¤æ¯ä¸ªæ­¥éª¤éƒ½æ­£ç¡®å®Œæˆ

2. **æŸ¥çœ‹é”™è¯¯ä¿¡æ¯**
   - æµè§ˆå™¨ Console (F12)
   - Netlify éƒ¨ç½²æ—¥å¿—
   - GitHub Actionsï¼ˆå¦‚æœæœ‰ï¼‰

3. **å¸¸è§é—®é¢˜**
   - å‚è€ƒä¸Šé¢çš„æ•…éšœæ’é™¤éƒ¨åˆ†
   - å¤§éƒ¨åˆ†é—®é¢˜éƒ½æœ‰è§£å†³æ–¹æ¡ˆ

---

**æ­å–œï¼æ‚¨ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªç¨³å®šå¯é çš„ CMS è®¤è¯ç³»ç»Ÿï¼** ğŸŠ

ä¸å†éœ€è¦æ‹…å¿ƒ Netlify Identity çš„ç™»å½•é—®é¢˜ï¼Œå¯ä»¥ä¸“æ³¨äºåˆ›ä½œå†…å®¹äº†ï¼

